
> library(keras)

> library(cloudml)

> base_dir <- "gs://dogs_v_cats"

> train_dir <- file.path(base_dir, "train")

> validation_dir <- file.path(base_dir, "validation")

> test_dir <- file.path(base_dir, "test")

> model <- keras_model_sequential() %>% layer_conv_2d(filters = 32, 
+     kernel_size = c(3, 3), activation = "relu", input_shape = c(150, 
+         .... [TRUNCATED] 

> model %>% compile(loss = "binary_crossentropy", optimizer = optimizer_rmsprop(lr = 1e-04), 
+     metrics = c("acc"))

> datagen <- image_data_generator(rescale = 1/255, rotation_range = 40, 
+     width_shift_range = 0.2, height_shift_range = 0.2, shear_range = 0.2, 
 .... [TRUNCATED] 

> test_datagen <- image_data_generator(rescale = 1/255)

> train_generator <- flow_images_from_directory(gs_local_dir(train_dir), 
+     datagen, target_size = c(150, 150), batch_size = 32, class_mode = "bin ..." ... [TRUNCATED] 

> validation_generator <- flow_images_from_directory(gs_local_dir(validation_dir), 
+     test_datagen, target_size = c(150, 150), batch_size = 20, 
+ .... [TRUNCATED] 

> history <- model %>% fit_generator(train_generator, 
+     steps_per_epoch = 100, epochs = 100, validation_data = validation_generator, 
+     valid .... [TRUNCATED] 

> export_savedmodel(model, "cats_and_dogs_small2")
